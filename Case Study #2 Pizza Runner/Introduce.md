# Case Study #2 Pizza Runner
<p align="center">
<img src="https://github.com/qanhnn12/8-Week-SQL-Challenge/blob/main/IMG/2.png" align="center" width="400" height="400">

\A summary table of the applied methods and techniques used in the SQL queries for different aspects of the analysis:

| **Category**                      | **Objective**                                                                 | **SQL Method/Technique Applied**                                                                                                                                                                                                                                     |
|-----------------------------------|-------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| **A. Pizza Metrics**              |                                                                               |                                                                                                                                                                                                                                                                      |
| 1. Total pizzas ordered           | Count total pizzas from customer orders                                       | `SELECT COUNT(*) FROM customer_orders`                                                                                                                                                                                                                               |
| 2. Unique customer orders         | Count distinct orders from runner orders                                      | `SELECT COUNT(DISTINCT order_id) FROM updated_runner_orders`                                                                                                                                                                                                         |
| 3. Successful deliveries per runner | Count non-canceled orders for each runner                                     | `SELECT runner_id, COUNT(order_id) FROM updated_runner_orders WHERE cancellation IS NULL GROUP BY runner_id`                                                                                                                                                         |
| 4. Pizza deliveries by type       | Count total deliveries for each pizza type                                    | `JOIN updated_customer_orders with runner_orders` + `GROUP BY pizza_id`                                                                                                                                                                                              |
| 5. Orders of each pizza type per customer | Classify orders by pizza type and count per customer                     | `CASE WHEN pizza_name` for meat/veget classification + `GROUP BY customer_id`                                                                                                                                                                                        |
| 6. Max pizzas in a single order   | Find the highest number of pizzas in one order                                | `SELECT MAX(COUNT(pizza_id)) FROM Updated_customer_orders GROUP BY order_id`                                                                                                                                                                                          |
| 7. Orders with/without changes    | Group customer orders by pizza changes or no changes                          | `SUM(CASE WHEN exclusions <> ' ' OR extras <> ' ' THEN 1 ELSE 0 END)`                                                                                                                                                                                                |
| 8. Pizzas with both exclusions and extras | Count pizzas with both exclusions and extras                            | `SUM(CASE WHEN exclusions <> ' ' AND extras <> ' ' THEN 1 ELSE 0 END)`                                                                                                                                                                                               |
| 9. Orders per hour of the day     | Group pizza orders by the hour of the day                                     | `DATEPART(hour, order_time)` + `GROUP BY`                                                                                                                                                                                                                            |
| 10. Orders per day of the week    | Group pizza orders by the day of the week                                     | `DATENAME(WEEKDAY, order_time)` + `GROUP BY`                                                                                                                                                                                                                         |
| **B. Runner and Customer Experience** |                                                                               |                                                                                                                                                                                                                                                                      |
| 1. Weekly runner signups          | Group runners by week starting from a given date                              | `CASE WHEN registration_date` between different date ranges + `GROUP BY`                                                                                                                                                                                             |
| 2. Avg. time to pickup per runner | Calculate the average pickup time for each runner                             | `AVG(DATEPART(MINUTE, pickup_time - order_time))` + `GROUP BY runner_id`                                                                                                                                                                                             |
| 3. Relationship between pizzas and prep time | Compare average prep time with pizza count                               | `WITH preparetime` for pickup duration + `GROUP BY pizza count`                                                                                                                                                                                                      |
| 4. Avg. distance traveled per customer | Calculate average delivery distance per customer                            | `AVG(distance)` + `GROUP BY customer_id`                                                                                                                                                                                                                             |
| 5. Delivery time differences      | Find the difference between max and min delivery times                        | `MAX(duration) - MIN(duration)`                                                                                                                                                                                                                                      |
| 6. Avg. speed per runner          | Calculate delivery speed and check trends per runner                          | `ROUND((60 * distance / duration), 2) AS speed_km` + `AVG(speed_km) OVER(PARTITION BY runner_id)`                                                                                                                                                                    |
| 7. Successful delivery percentage | Calculate percentage of successful deliveries for each runner                 | `ROUND(100 * COUNT(pickup_time) / COUNT(order_id))` + `GROUP BY runner_id`                                                                                                                                                                                           |
| **C. Ingredient Optimization**    |                                                                               |                                                                                                                                                                                                                                                                      |
| 1. Standard pizza ingredients     | Retrieve and combine toppings for each pizza                                  | `STRING_AGG(topping_name, ',') AS topping_list`                                                                                                                                                                                                                      |
| 2. Most common extra              | Count occurrences of extra toppings                                           | `STRING_SPLIT(extras, ',')` + `GROUP BY topping_name`                                                                                                                                                                                                                |
| 3. Most common exclusion          | Count occurrences of excluded toppings                                        | `STRING_SPLIT(exclusions, ',')` + `GROUP BY topping_name`                                                                                                                                                                                                            |
| 4. Generate descriptive order items | Create labels with exclusions/extras for each order                          | `ROW_NUMBER()` + `CASE` for conditional order description generation                                                                                                                                                                                                 |
| 5. Alphabetical ingredient list per pizza | List ingredients alphabetically, append '2x' for duplicates              | `STRING_AGG(topping, ',') ORDER BY topping_name`                                                                                                                                                                                                                     |
| 6. Total quantity of each ingredient used | Count usage of each ingredient across pizzas, including extras/exclusions | `STRING_SPLIT(extras, exclusions)` + `GROUP BY topping_name`                                                                                                                                                                                                         |
| **D. Pricing and Ratings**        |                                                                               |                                                                                                                                                                                                                                                                      |
| 1. Total revenue                  | Calculate total revenue from completed orders                                 | `SUM(CASE WHEN pizza_name = 'Meatlovers' THEN 12 ELSE 10 END)`                                                                                                                                                                                                       |
| 2. Extra charge for pizza extras  | Adjust total cost by adding $1 per extra topping                              | `SUM(cost + LEN(REPLACE(extras, ',', '')))`                                                                                                                                                                                                                          |
| 3. Create ratings table           | Design table schema for runner ratings and insert data                        | `CREATE TABLE ratings` + `INSERT INTO`                                                                                                                                                                                                                               |
| 4. Join all information on successful deliveries | Combine customer, order, runner, and timing details into a final table | `JOIN customer_orders with runner_orders` + `GROUP BY`                                                                                                                                                                                                               |
| 5. Calculate net revenue after runner costs | Deduct runner costs (paid per km) from total revenue                     | `SUM(revenue) - SUM(distance * 0.3)`                                                                                                                                                                                                                                 |

This table organizes the objectives and corresponding SQL methods used for each part of the analysis.
